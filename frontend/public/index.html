<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b7285" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#074d52" media="(prefers-color-scheme: dark)" />
  <meta name="description" content="CoRGi - Comparative Regulatory Genomics platform for exploring aligned nucleotide sequences across species" />
  <meta name="keywords" content="genomics, comparative genomics, DNA sequences, regulatory elements, bioinformatics" />
  
  <title>CoRGi - Comparative Regulatory Genomics</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  
  <!-- Preload critical resources -->
  <link rel="preload" href="styles.css" as="style" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  
  <link rel="stylesheet" href="styles.css" />
  
  <!-- Theme-aware critical CSS (replaces hard-coded light styles) -->
  <style>
    :root { color-scheme: light dark; }
    body { 
      margin: 0; 
      font-family: system-ui, -apple-system, sans-serif; 
      background: var(--bg);
      color: var(--text);
    }
    .loading-screen {
      position: fixed; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #f8fbff 0%, #e8f4fd 100%);
      z-index: 9999; opacity: 1; transition: opacity 300ms ease;
    }
    @media (prefers-color-scheme: dark) {
      .loading-screen {
        background: linear-gradient(135deg, #0f1720 0%, #1a2332 100%);
      }
    }
    .loading-spinner {
      width: 50px; height: 50px;
      border: 4px solid rgba(11,114,133,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <!-- Loading screen -->
  <div class="loading-screen" id="loading-screen" aria-live="polite" aria-label="Loading">
    <div class="loading-spinner" role="status" aria-label="Loading content"></div>
  </div>

  <!-- Navigation -->
  <div id="navbar-placeholder"></div>
  
  <script>
    // Immediate navbar loading for better perceived performance
    (function() {
      const navbarCache = sessionStorage.getItem('navbar-html');
      const navbarPlaceholder = document.getElementById('navbar-placeholder');
      
      if (navbarCache) {
        navbarPlaceholder.innerHTML = navbarCache;
        updateActiveNav();
      }
      
      fetch('navbar.html', { priority: 'high' })
        .then(response => response.text())
        .then(data => {
          navbarPlaceholder.innerHTML = data;
          sessionStorage.setItem('navbar-html', data);
          updateActiveNav();
        })
        .catch(error => {
          console.error('Error loading navbar:', error);
          navbarPlaceholder.innerHTML = '<nav class="navbar" role="navigation"><div class="navbar-inner"><div class="site-title">ðŸ§¬ CoRGi</div></div></nav>';
        })
        .finally(() => {
          hideLoadingScreen();
        });
      
      function updateActiveNav() {
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        document.querySelectorAll('.nav-tab').forEach(tab => {
          const href = tab.getAttribute('href');
          if (href === currentPage || (currentPage === '' && href === 'index.html')) {
            tab.classList.add('active');
            tab.setAttribute('aria-current', 'page');
          }
        });
      }
      
      function hideLoadingScreen() {
        setTimeout(() => {
          const loadingScreen = document.getElementById('loading-screen');
          if (loadingScreen) {
            loadingScreen.style.opacity = '0';
            setTimeout(() => loadingScreen.remove(), 300);
          }
        }, 400);
      }
    })();
  </script>

  <main class="container">
    <!-- Hero Section -->
    <section class="hero-section" aria-labelledby="hero-title">
      <h1 id="hero-title" class="hero-title">ðŸ§¬ Welcome to CoRGi</h1>
      <p class="hero-subtitle">
        Comparative Regulatory Genomics<br>
        Explore aligned nucleotide sequences across multiple species
      </p>
      <a href="browse-genes.html" class="cta-button" role="button">
        Start Browsing Genes â†’
      </a>
    </section>

    <!-- Features Grid -->
    <div class="features-grid" role="list">
      <article class="feature-card" role="listitem">
        <a href="browse-genes.html" class="feature-link">
          <span class="feature-icon" role="img" aria-label="DNA">ðŸ§¬</span>
          <h2 class="feature-title">Browse Genes</h2>
          <p class="feature-description">
            Interactive genome browser with drag-to-zoom functionality. View aligned sequences across human, mouse, and macaque.
          </p>
        </a>
      </article>

      <article class="feature-card" role="listitem">
        <a href="compare-genomes.html" class="feature-link">
          <span class="feature-icon" role="img" aria-label="Compare">ðŸ“Š</span>
          <h2 class="feature-title">Compare Genomes</h2>
          <p class="feature-description">
            Side-by-side comparison of genomic sequences. Identify conserved regions and evolutionary differences.
          </p>
        </a>
      </article>

      <article class="feature-card" role="listitem">
        <a href="contact.html" class="feature-link">
          <span class="feature-icon" role="img" aria-label="Contact">ðŸ“§</span>
          <h2 class="feature-title">Get In Touch</h2>
          <p class="feature-description">
            Questions or collaboration opportunities? We'd love to hear from you. All data is publicly available.
          </p>
        </a>
      </article>
    </div>

    <!-- About Section -->
    <section class="about-section" aria-labelledby="about-title">
      <h2 id="about-title" class="about-title">About CoRGi</h2>
      <p class="about-text">
        CoRGi (Comparative Regulatory Genomics) is a platform designed to make genomics data accessible and understandable. We provide carefully curated, aligned nucleotide sequences across multiple species, helping researchers identify conserved regulatory elements and evolutionary patterns.
      </p>
      <p class="about-text">
        Our user-friendly interface replaces complex command-line tools with intuitive visualizations, making comparative genomics accessible to researchers at all levels.
      </p>

      <!-- Statistics -->
      <div class="stats-grid" role="list">
        <div class="stat-card" role="listitem">
          <span class="stat-number">3</span>
          <span class="stat-label">Species</span>
        </div>
        <div class="stat-card" role="listitem">
          <span class="stat-number">100+</span>
          <span class="stat-label">Genes</span>
        </div>
        <div class="stat-card" role="listitem">
          <span class="stat-number">1M+</span>
          <span class="stat-label">Base Pairs</span>
        </div>
      </div>
    </section>
  </main>

  <!-- PWA Install Prompt (hidden by default) -->
  <div id="install-prompt" class="install-prompt hidden" role="dialog" aria-labelledby="install-title" aria-describedby="install-description">
    <div class="install-content">
      <h3 id="install-title">Install CoRGi</h3>
      <p id="install-description">Add CoRGi to your home screen for quick access and offline capability.</p>
      <div class="install-buttons">
        <button id="install-button" class="install-accept">Install</button>
        <button id="install-dismiss" class="install-dismiss">Not Now</button>
      </div>
    </div>
  </div>

  <script>
    // Haptic feedback utility
    function vibrate(duration = 10) {
      if ('vibrate' in navigator) {
        navigator.vibrate(duration);
      }
    }

    // Add haptic feedback to interactive elements
    document.addEventListener('DOMContentLoaded', () => {
      const interactiveElements = document.querySelectorAll('a, button, .feature-card');
      interactiveElements.forEach(el => {
        el.addEventListener('touchstart', () => vibrate(10), { passive: true });
      });
    });

    // PWA install prompt handling
    let deferredPrompt;
    const installPrompt = document.getElementById('install-prompt');
    const installButton = document.getElementById('install-button');
    const dismissButton = document.getElementById('install-dismiss');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Show install prompt after 3 seconds
      setTimeout(() => {
        if (!localStorage.getItem('pwa-dismissed')) {
          installPrompt.classList.remove('hidden');
        }
      }, 3000);
    });

    if (installButton) {
      installButton.addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response: ${outcome}`);
          deferredPrompt = null;
        }
        installPrompt.classList.add('hidden');
      });
    }

    if (dismissButton) {
      dismissButton.addEventListener('click', () => {
        installPrompt.classList.add('hidden');
        localStorage.setItem('pwa-dismissed', 'true');
      });
    }

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('Service Worker registered:', reg.scope))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }

    // Performance monitoring
    if ('PerformanceObserver' in window) {
      const observer = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          if (entry.entryType === 'largest-contentful-paint') {
            console.log('LCP:', entry.startTime);
          }
        }
      });
      observer.observe({ entryTypes: ['largest-contentful-paint'] });
    }
  </script>
</body>
</html>