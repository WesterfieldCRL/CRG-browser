<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#0b7285" />
  
  <title>CoRGi - Browse Genes</title>
  
  <link rel="stylesheet" href="styles-mobile-improved.css" />
  <link rel="apple-touch-icon" href="icon.png" />
  
  <style>
    /* Gene selection styles */
    .gene-search-container {
      margin-bottom: 20px;
    }
    
    .search-input {
      width: 100%;
      padding: 16px 20px;
      font-size: 1rem;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: var(--panel-bg);
      color: var(--text);
      transition: all 200ms ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(45,180,182,0.1), 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .search-input::placeholder {
      color: var(--muted);
    }
    
    .gene-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding: 16px;
      background: white;
      border-radius: 12px;
      border: 2px solid var(--border);
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    }
    
    @media (prefers-color-scheme: dark) {
      .gene-grid {
        background: var(--panel-bg);
      }
    }
    
    .gene-button {
      min-height: 52px;
      padding: 14px 18px;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafb 100%);
      border: 2px solid var(--border);
      border-radius: 10px;
      font-weight: 700;
      font-size: 0.95rem;
      color: var(--primary);
      cursor: pointer;
      transition: all 200ms ease;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      position: relative;
    }
    
    @media (prefers-color-scheme: dark) {
      .gene-button {
        background: linear-gradient(135deg, var(--bg) 0%, #1a2332 100%);
        border-color: var(--border-strong);
      }
    }
    
    .gene-button:active {
      transform: scale(0.96);
      transition-duration: 50ms;
    }
    
    .gene-button.selected {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(45,180,182,0.3), 0 2px 6px rgba(45,180,182,0.2);
      transform: scale(1.02);
    }
    
    .gene-button.hidden {
      display: none;
    }
    
    .no-results {
      grid-column: 1 / -1;
      text-align: center;
      padding: 32px 16px;
      color: var(--muted);
      font-size: 1rem;
      font-weight: 600;
    }
    
    .gene-count {
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 12px;
      font-weight: 600;
      padding: 8px;
      background: var(--panel-bg);
      border-radius: 8px;
    }
    
    .section-header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: 1.5rem;
      color: var(--primary);
      margin: 0 0 8px 0;
      font-weight: 900;
    }
    
    .section-subtitle {
      font-size: 0.95rem;
      color: var(--muted);
      margin: 0;
    }
    
    @media (min-width: 601px) {
      .gene-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div id="navbar-placeholder"></div>
  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      fetch('navbar-mobile.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('navbar-placeholder').innerHTML = data;
          const currentPage = window.location.pathname.split('/').pop() || 'browse-genes-mobile.html';
          document.querySelectorAll('.nav-tab').forEach(tab => {
            if (tab.getAttribute('href') === currentPage) {
              tab.classList.add('active');
            }
          });
        })
        .catch(error => console.error('Error loading navbar:', error));
    });
  </script>

  <main class="container">
    <!-- Gene selection section -->
    <section id="gene-selection-section" aria-labelledby="gene-selection-title">
      <div class="section-header">
        <h2 id="gene-selection-title" class="section-title">Select a Gene</h2>
        <p class="section-subtitle">Choose from our curated collection</p>
      </div>
      
      <div class="gene-search-container">
        <input 
          type="search" 
          id="gene-search" 
          class="search-input"
          placeholder="üîç Search genes..."
          aria-label="Search for genes"
          autocomplete="off"
        />
      </div>
      
      <div class="gene-grid" id="gene-grid" role="listbox" aria-label="Available genes">
        <div class="no-results" id="loading-genes">Loading genes...</div>
      </div>
      
      <div class="gene-count" id="gene-count" aria-live="polite"></div>
    </section>

    <!-- Overview section with zoom capability -->
    <section id="overview-section" class="hidden" aria-labelledby="overview-title">
      <div class="section-header">
        <h2 id="overview-title" class="section-title">Sequence Overview</h2>
      </div>
      <div class="overview-instruction">
        <strong>üëÜ Tap and drag</strong> on the sequence below to zoom in
      </div>
      <div class="overview-row" 
           id="overview-summary" 
           role="slider"
           aria-label="Sequence overview - drag to select region"
           tabindex="0">
      </div>
      <div class="overview-info">
        <span>Viewing: <strong id="zoom-range-display">Loading...</strong></span>
      </div>
    </section>

    <!-- Detailed sequence view -->
    <section id="details-section" class="hidden" aria-labelledby="details-title">
      <div class="section-header">
        <h2 id="details-title" class="section-title">Detailed View</h2>
      </div>
      
      <div class="tracks-container">
        <div class="track">
          <div class="species-label">
            <span role="img" aria-label="Human">üë§</span> Homo sapiens
          </div>
          <div class="sequence" id="seq-human" aria-live="polite" aria-atomic="true"></div>
        </div>

        <div class="track">
          <div class="species-label">
            <span role="img" aria-label="Mouse">üê≠</span> Mus musculus
          </div>
          <div class="sequence" id="seq-mouse" aria-live="polite" aria-atomic="true"></div>
        </div>

        <div class="track">
          <div class="species-label">
            <span role="img" aria-label="Macaque">üêµ</span> Macaca mulatta
          </div>
          <div class="sequence" id="seq-macaque" aria-live="polite" aria-atomic="true"></div>
        </div>
      </div>

      <!-- Pagination controls -->
      <div class="pagination-controls">
        <button id="btn-prev-page" aria-label="Previous page">&lt;</button>
        <label for="input-page">Page</label>
        <input id="input-page" 
               type="number" 
               min="1" 
               value="1" 
               aria-label="Current page number"
               inputmode="numeric" />
        <span id="page-count-label">of 1</span>
        <button id="btn-next-page" aria-label="Next page">&gt;</button>
      </div>

      <!-- Action buttons -->
      <div class="action-buttons">
        <button id="btn-reset" aria-label="Reset view">üîÑ Reset</button>
        <button id="btn-download" aria-label="Download sequences">‚¨áÔ∏è Download</button>
      </div>
    </section>
  </main>

  <script src="browse-genes.js"></script>

  <script>
    // Haptic feedback
    function vibrate(duration = 10) {
      if ('vibrate' in navigator) {
        navigator.vibrate(duration);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('button, .nav-tab, .gene-button').forEach(btn => {
        btn.addEventListener('touchstart', () => vibrate(10));
      });
    });

    // Prevent double-tap zoom
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300 && e.target.classList.contains('nucleotide-box')) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, { passive: false });

    // Handle orientation changes
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        if (window.renderDetailedSequences && typeof window.renderDetailedSequences === 'function') {
          window.renderDetailedSequences();
        }
      }, 200);
    });
  </script>
</body>
</html>
